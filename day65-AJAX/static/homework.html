<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
    <script src="js/common.js"></script>
    <script src="js/jquery-1.11.3.js"></script>
    <script>
        function uCheck(){
            var ret = true; //表示用户名称不存在
            var xhr1 = createXhr();
            var uname = $("#uname").val();
            xhr1.open("get", "/register?uname="+uname, false);
            xhr1.onreadystatechange = function() {
                if(xhr1.readyState==4&&xhr1.status==200){
                    if(xhr1.responseText=="1"){
                        $("#ucheck").html("用户名已存在");
                        ret = false;
                    }else{
                        $("#ucheck").html("用户名合法");
                    }
                }
            }
            xhr1.send(null);
            return ret;
        }
        function btnClick(){
            if(uCheck()){
                var xhr2 = createXhr();
                xhr2.open("post", "/register", true);
                xhr2.onreadystatechange = function () {
                    if(xhr2.readyState==4&&xhr2.status==200){
                        alert(xhr2.responseText);
                    }
                }
                xhr2.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
                var uname = $("#uname").val();
                var upwd = $("#upwd").val();
                var email = $("#uemail").val();
                var msg = "uname="+uname+"&upwd="+upwd+"&uemail="+email;
                xhr2.send(msg);
            }else{
                alert("用户名称已存在")
            }
            
        }
        // 页面加载完成后要执行的操作
        $(function(){
            $("#uname").blur(function(){
                uCheck();
            })
            $("#btnReg").click(function(){
                btnClick();
            })
        })
    </script>
    <p>
        用户名称：<input type="text" name="uname" id="uname">
        <span id="ucheck"></span>
    </p>
    <p>
        用户密码：<input type="password" name="upwd" id="upwd">
    </p>
    <p>
        电子邮箱：<input type="email" name="uemail" id="uemail">
    </p>
    <p>
        <button id="btnReg"">注册</button>
    </p>
</body>
</html>